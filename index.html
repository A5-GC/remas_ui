<!DOCTYPE html>
<html>
<head>
    <title>Login & Account Creation</title>
    <style>
        body, html { margin: 0; overflow: hidden; width: 100%; height: 100%; background: white; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; }
        #logo {
            opacity: 0;
            transition: opacity 3s ease-in-out;
            width: 50px; /* Adjust size as needed */
        }
        #fullscreen-btn {
            position: absolute;
            bottom: 10px;
            right: 10px;
            padding: 5px 10px;
            font-size: 12px;
            cursor: pointer;
            border: none;
            background-color: grey;
            color: white;
            border-radius: 3px;
        }
        #fullscreen-btn:hover {
            background-color: darkgrey;
        }
        #password-container {
            position: absolute;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: rgba(0, 0, 0, 0.7);
            padding: 20px;
            border-radius: 5px;
        }
        #password-input {
            padding: 5px;
            font-size: 14px;
        }
        #password-btn {
            padding: 5px 10px;
            margin-top: 10px;
            font-size: 14px;
            cursor: pointer;
            background-color: grey;
            color: white;
            border: none;
            border-radius: 3px;
        }
        #password-btn:hover {
            background-color: darkgrey;
        }
        #login-container, #signup-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px;
        }
        #login-container input, #signup-container input {
            margin: 10px;
            padding: 10px;
            width: 200px;
            font-size: 14px;
        }
        #login-container button, #signup-container button {
            padding: 10px 20px;
            background-color: grey;
            color: white;
            border: none;
            font-size: 14px;
            margin-top: 10px;
            cursor: pointer;
        }
        #login-container button:hover, #signup-container button:hover {
            background-color: darkgrey;
        }
    </style>
</head>
<body>
    <div id="login-container">
        <h2>Login</h2>
        <input type="email" id="email" placeholder="Enter email" />
        <input type="password" id="password" placeholder="Enter password" />
        <button id="login-btn" onclick="login()">Login</button>
        <button id="signup-btn" onclick="showSignup()">Sign Up</button>
    </div>

    <div id="signup-container" style="display:none;">
        <h2>Create an Account</h2>
        <input type="email" id="signup-email" placeholder="Enter email" />
        <input type="password" id="signup-password" placeholder="Enter password" />
        <button id="signup-submit" onclick="signup()">Create Account</button>
        <button id="cancel-signup" onclick="cancelSignup()">Cancel</button>
    </div>

    <div id="content-container" style="display:none;">
        <div id="password-container">
            <input type="password" id="password-input" placeholder="Enter Password" />
            <button id="password-btn" onclick="checkPassword()">Submit</button>
        </div>
        <img id="logo" src="logo.png" alt="ATOM 5 Logo">
        <button id="fullscreen-btn" onclick="toggleFullScreen()">â›¶</button>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-storage.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "your-api-key",
            authDomain: "your-auth-domain",
            projectId: "your-project-id",
            storageBucket: "your-storage-bucket",
            messagingSenderId: "your-sender-id",
            appId: "your-app-id"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const storage = firebase.storage();
        
        let userId;

        // Show the signup form
        function showSignup() {
            document.getElementById("login-container").style.display = "none";
            document.getElementById("signup-container").style.display = "block";
        }

        // Cancel signup and go back to login
        function cancelSignup() {
            document.getElementById("signup-container").style.display = "none";
            document.getElementById("login-container").style.display = "block";
        }

        // Handle user signup
        async function signup() {
            const email = document.getElementById("signup-email").value;
            const password = document.getElementById("signup-password").value;

            try {
                const userCredential = await auth.createUserWithEmailAndPassword(email, password);
                userId = userCredential.user.uid;
                createUserBucket(userId);
                alert("Sign Up Successful! Please log in.");
                cancelSignup();
            } catch (error) {
                alert(error.message);
            }
        }

        // Handle user login
        async function login() {
            const email = document.getElementById("email").value;
            const password = document.getElementById("password").value;

            try {
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                userId = userCredential.user.uid;
                alert("Login Successful!");
                displayContent();
            } catch (error) {
                alert(error.message);
            }
        }

        // Create a unique storage bucket for the user
        async function createUserBucket(userId) {
            const bucketName = `your-project-id-user-buckets/${userId}/maps/`;

            // Call your backend to create a bucket or set the user's folder in Cloud Storage
            try {
                const response = await fetch('/create-bucket', {
                    method: 'POST',
                    body: JSON.stringify({ userId: userId, bucketName: bucketName }),
                    headers: { 'Content-Type': 'application/json' },
                });

                if (response.ok) {
                    console.log("Bucket created or assigned for user.");
                } else {
                    alert("Error creating bucket.");
                }
            } catch (error) {
                console.error("Error with creating user bucket:", error);
            }
        }

        // Check password to trigger intro animation
        function checkPassword() {
            const password = document.getElementById("password-input").value;
            const correctPassword = "siliconfuture2100"; // Same password as before for intro animation
            if (password === correctPassword) {
                document.getElementById("password-container").style.display = "none";
                showIntroAnimation();
            } else {
                alert("Incorrect password, please try again.");
            }
        }

        function showIntroAnimation() {
            let logo = document.getElementById("logo");
            setTimeout(() => { logo.style.opacity = "1"; }, 500); // Fade in delay
            setTimeout(() => { logo.style.opacity = "0"; }, 4500); // Fade out after 4.5s
        }

        function toggleFullScreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else if (document.exitFullscreen) {
                document.exitFullscreen();
            }
        }

        // Display content after login
        function displayContent() {
            document.getElementById("login-container").style.display = "none";
            document.getElementById("signup-container").style.display = "none";
            document.getElementById("content-container").style.display = "block";
        }
    </script>
</body>
</html>
