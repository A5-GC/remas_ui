<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulation</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js"></script>
</head>
<body>
    <div id="simulation-container">
        <div id="simulation-area">
            <canvas id="simulation-canvas"></canvas>
        </div>

        <!-- Right Panel -->
        <div id="right-panel">
            <div class="toolbar">
                <button id="minimize-panel">➖</button>
            </div>

            <!-- File Explorer (No Title) -->
            <div id="file-explorer">
                <ul id="file-list"></ul>
            </div>
        </div>
    </div>

    <!-- Fullscreen Button -->
    <button id="fullscreen-btn">⛶</button>

    <script>
        // Firebase Configuration (Ensure you replace with your real credentials)
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID"
        };
        firebase.initializeApp(firebaseConfig);

        // Redirect to login if not authenticated
        firebase.auth().onAuthStateChanged(user => {
            if (!user) {
                window.location.href = "login.html"; // Redirect if not authenticated
            } else {
                loadUserFiles(user.email);
            }
        });

        // Load Files from Firebase Storage
        function loadUserFiles(email) {
            const storageRef = firebase.storage().ref(`users/${email}/files`);
            const fileList = document.getElementById("file-list");
            fileList.innerHTML = ""; // Clear previous entries

            storageRef.listAll()
                .then(result => {
                    result.items.forEach(fileRef => {
                        fileRef.getDownloadURL().then(url => {
                            const li = document.createElement("li");
                            li.textContent = fileRef.name;
                            li.onclick = () => window.open(url, "_blank");
                            fileList.appendChild(li);
                        });
                    });
                })
                .catch(error => console.log("Error fetching files:", error));
        }

        // Minimize Right Panel
        const rightPanel = document.getElementById("right-panel");
        const minimizePanelBtn = document.getElementById("minimize-panel");
        minimizePanelBtn.addEventListener("click", function () {
            rightPanel.classList.toggle("minimized");
        });

        // Fullscreen Toggle
        const fullscreenBtn = document.getElementById("fullscreen-btn");
        fullscreenBtn.addEventListener("click", function () {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        });
    </script>
</body>
</html>
